@model IEnumerable<GoCoffeeTea.Models.Order>

@{
    ViewData["Title"] = "Quản lý Đơn hàng";
}

<h2 class="mb-4 text-primary">🧾 Quản lý Đơn hàng</h2>
<hr />

<div class="card shadow-sm">
    <div class="card-body">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Mã ĐH</th>
                    <th>Ngày bán</th>
                    <th>Khách hàng</th>
                    <th>Nhân viên</th>
                    <th>Giảm giá</th>
                    <th>Tổng tiền (VNĐ)</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr class="@(item.Status == "Cancelled" ? "table-danger text-muted" : "")">
                        <td>#@item.OrderID</td>
                        <td>@item.OrderDate.ToString("dd/MM/yy HH:mm")</td>

                        <td>@(item.Customer?.FullName ?? "Khách vãng lai")</td>

                        <td>
                            @(item.Employee != null ? item.Employee.FullName : "N/A")
                        </td>
                        <td>
                            @if (item.DiscountAmount > 0)
                            {
                                <span class="badge bg-warning text-dark">- @item.DiscountAmount.ToString("N0")</span>
                            }
                            else
                            {
                                <span>0</span>
                            }
                        </td>
                        <td>
                            <strong class="text-success">@item.FinalAmount.ToString("N0")</strong>
                        </td>
                        <td>
                            @if (item.Status == "Completed")
                            {
                                <span class="badge bg-success">Hoàn tất</span>
                            }
                            else
                            {
                                <span class="badge bg-danger">Hủy bỏ</span>
                            }
                        </td>
                        <td>
                            <a asp-area="Admin" asp-action="Details" asp-route-id="@item.OrderID" class="btn btn-sm btn-primary me-2" title="Xem chi tiết">
                                <i class="fas fa-eye"></i> Chi tiết
                            </a>

                            @if (item.Status == "Completed")
                            {
                                <form asp-area="Admin" asp-action="Cancel" asp-route-id="@item.OrderID" method="post" class="d-inline"
                                      onsubmit="return confirm('XÁC NHẬN HỦY đơn hàng?');">
                                    <button type="submit" class="btn btn-sm btn-danger" title="Hủy đơn hàng">
                                        <i class="fas fa-times"></i> Hủy
                                    </button>
                                </form>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>